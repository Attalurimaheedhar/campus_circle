<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sell an Item</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* ===== STYLES REMAIN UNCHANGED ===== */
body {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f5f9f6;
    font-family: "Poppins", sans-serif;
}

.sell-card {
    width: 420px;
    background: #ffffff;
    padding: 28px 26px;
    border-radius: 14px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.08);
}

.sell-card h2 {
    text-align: center;
    margin-bottom: 22px;
    font-weight: 600;
}

.form-group {
    margin-bottom: 14px;
}

.form-group label {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 6px;
    display: block;
}

.sell-card input,
.sell-card textarea,
.sell-card select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
}

.sell-card textarea {
    resize: none;
}

.price-row {
    display: flex;
    gap: 10px;
    align-items: center;
}

.price-row input {
    flex: 1;
}

.free-checkbox {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    white-space: nowrap;
}

/* Image Upload */
.image-upload {
    border: 2px dashed #8fd19e;
    border-radius: 12px;
    padding: 18px;
    text-align: center;
    transition: 0.2s;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    min-height: 80px;
    position: relative;
}

.image-upload input {
    display: none;
}

.image-upload .thumb-wrapper {
    position: relative;
}

.image-upload .thumb {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #ccc;
}

.image-upload .remove-btn {
    position: absolute;
    top: -6px;
    right: -6px;
    background: rgba(0,0,0,0.7);
    color: white;
    font-size: 12px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    text-align: center;
    line-height: 18px;
    cursor: pointer;
}

/* + Button */
.add-more {
    width: 60px;
    height: 60px;
    border: 2px dashed #8fd19e;
    border-radius: 8px;
    font-size: 28px;
    color: #2ecc71;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

/* Hint */
.image-hint {
    text-align: center;
    font-size: 12px;
    color: #777;
    margin-top: 6px;
}

/* Button */
.sell-card button {
    margin-top: 18px;
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 10px;
    background: #2ecc71;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

.sell-card button:hover {
    background: #27ae60;
}
</style>
</head>

<body>

<div class="sell-card">
    <h2>Sell an Item</h2>

    <form method="POST" enctype="multipart/form-data" id="sellForm">

        <div class="form-group">
            <label>Item Name *</label>
            <input type="text" name="name" required>
        </div>

        <div class="form-group">
            <label>Category *</label>
            <select name="category" id="category" required>
                <option value="">Select category</option>
                <option>Books</option>
                <option>Clothes</option>
                <option>Gadgets</option>
                <option>Stationery</option>
                <option>Free Items</option>
            </select>
        </div>

        <div class="form-group">
            <label>Price *</label>
            <div class="price-row">
                <input type="number" id="price" name="price" min="0" required>
                <div class="free-checkbox">
                    <input type="checkbox" id="free">
                    <label for="free">Free</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>Description *</label>
            <textarea name="description" rows="3" required></textarea>
        </div>

        <div class="form-group">
            <label>Product Images *</label>
            <div class="image-upload" id="image-upload">
                <input type="file" id="images" name="images" accept="image/*" multiple>
                <div id="add-more" class="add-more">+</div>
            </div>
            <div class="image-hint">Minimum 1 image, Max 5</div>
        </div>

        <button type="submit">Post Item</button>
    </form>
</div>

<script>
const imageInput = document.getElementById('images');
const uploadBox = document.getElementById('image-upload');
const addMoreBtn = document.getElementById('add-more');
const form = document.getElementById('sellForm');
const priceInput = document.getElementById('price');
const freeCheckbox = document.getElementById('free');
const categorySelect = document.getElementById('category');

let imageFiles = [];

addMoreBtn.addEventListener('click', () => imageInput.click());

imageInput.addEventListener('change', () => {
    const files = Array.from(imageInput.files);

    if (imageFiles.length + files.length > 5) {
        alert("Maximum 5 images allowed");
        return;
    }

    files.forEach(file => {
        imageFiles.push(file);

        const reader = new FileReader();
        reader.onload = e => {
            const wrapper = document.createElement('div');
            wrapper.className = 'thumb-wrapper';

            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'thumb';

            const remove = document.createElement('div');
            remove.className = 'remove-btn';
            remove.innerHTML = 'Ã—';
            remove.onclick = ev => {
                ev.stopPropagation();
                imageFiles = imageFiles.filter(f => f !== file);
                wrapper.remove();
                syncFiles();
            };

            wrapper.append(img, remove);
            uploadBox.insertBefore(wrapper, addMoreBtn);
        };
        reader.readAsDataURL(file);
    });

    syncFiles();
});

function syncFiles() {
    const dt = new DataTransfer();
    imageFiles.forEach(f => dt.items.add(f));
    imageInput.files = dt.files;
}

// ---------------- Price & Free Sync ----------------
function updatePrice() {
    if (freeCheckbox.checked || categorySelect.value === "Free Items") {
        priceInput.value = 0;           // Always 0
        priceInput.disabled = true;
        freeCheckbox.checked = true;    // Sync checkbox
        categorySelect.value = "Free Items"; // Sync category
    } else {
        priceInput.disabled = false;
        priceInput.value = "";          // Let user type price
        freeCheckbox.checked = false;
        if (categorySelect.value === "Free Items") categorySelect.value = "";
    }
}

// Checkbox change
freeCheckbox.addEventListener("change", () => {
    updatePrice();
});

// Category change
categorySelect.addEventListener("change", updatePrice);

// Initialize on page load
updatePrice();

// ---------------- Form submit validation ----------------
form.addEventListener('submit', e => {
    if (imageFiles.length === 0) {
        alert("Please add at least one image");
        e.preventDefault();
        return;
    }

    if (freeCheckbox.checked || categorySelect.value === "Free Items") {
        priceInput.value = 0;   // enforce 0 for MySQL NOT NULL
    }
});
</script>

</body>
</html>
